<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2000 å–®å­—æŒ‘æˆ° - åˆ†é›¢å¼è³‡æ–™ç‰ˆ</title>
    
    <!-- 1. è‡ªå‹•é€£çµå–®å­—åº«æª”æ¡ˆ -->
    <script src="jh2000.js"></script>

    <!-- 2. å¼•å…¥å™´å½©å¸¶ç‰¹æ•ˆ -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    
    <style>
        :root {
            --primary-bg: #1a1a1a;
            --card-bg: #2c2c2c;
            --accent-gold: #f1c40f;
            --accent-red: #c0392b;
            --correct-green: #27ae60;
            --text-white: #ffffff;
        }

        body {
            font-family: 'PingFang TC', 'Microsoft JhengHei', sans-serif;
            background-color: var(--primary-bg);
            color: var(--text-white);
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            overflow: hidden;
        }

        .quiz-container {
            background-color: var(--card-bg);
            padding: 2rem;
            border-radius: 24px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
            width: 90%;
            max-width: 500px;
            text-align: center;
            border: 1px solid #444;
            max-height: 95vh;
            overflow-y: auto;
        }

        #quiz-screen, #result-screen { display: none; }

        .input-group { margin: 25px 0; text-align: left; }
        .input-group label { display: block; margin-bottom: 12px; color: var(--accent-gold); font-weight: bold; font-size: 1.2rem; }
        .num-input { 
            width: 100%; padding: 15px; background: #333; border-radius: 12px; 
            color: #fff; border: 2px solid #444; box-sizing: border-box; 
            font-size: 1.5rem; text-align: center;
        }

        .score-board {
            background-color: var(--accent-red);
            padding: 12px;
            border-radius: 12px;
            margin-bottom: 20px;
            font-weight: bold;
            font-size: 1.2rem;
        }

        .question-area {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
            min-height: 5rem;
        }

        .chinese-hint {
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--accent-gold);
            line-height: 1.3;
        }

        .audio-btn {
            background: #444;
            border: none;
            color: #fff;
            font-size: 1.5rem;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: 0.2s;
        }
        .audio-btn:hover { background: #666; transform: scale(1.1); }

        .length-info { color: #888; letter-spacing: 5px; font-family: 'Courier New', monospace; font-size: 1.3rem; margin-bottom: 25px; }

        input[type="text"] {
            width: 95%; padding: 15px; font-size: 1.8rem; border: 3px solid #444; 
            border-radius: 12px; background-color: #333; color: #fff; 
            text-align: center; outline: none; transition: 0.3s;
        }

        .btn { padding: 18px; font-size: 1.2rem; border: none; border-radius: 12px; cursor: pointer; font-weight: bold; width: 100%; transition: 0.2s; margin-top: 10px; }
        .primary-btn { background: linear-gradient(135deg, #c0392b, #8e44ad); color: white; }
        .review-btn { background: linear-gradient(135deg, #f39c12, #e67e22); color: white; }
        .restart-btn { background-color: #444; color: #ccc; }
        .btn:hover { filter: brightness(1.2); transform: scale(1.02); }

        .mistake-container { margin-top: 15px; text-align: left; background: #1a1a1a; border-radius: 10px; padding: 10px; max-height: 200px; overflow-y: auto; }
        .mistake-table { width: 100%; border-collapse: collapse; font-size: 0.9rem; }
        .mistake-table th, .mistake-table td { padding: 10px; border-bottom: 1px solid #333; }
        .mistake-table th { color: var(--accent-gold); text-align: left; }
        .correct-ans { color: var(--correct-green); font-weight: bold; font-family: monospace; font-size: 1.1rem; }

        .final-score { font-size: 6rem; color: var(--accent-gold); font-weight: 900; margin: 0; }
        .correct-flash { border-color: var(--correct-green) !important; background-color: #1e392a !important; }
        .wrong-flash { border-color: var(--accent-red) !important; background-color: #3d1c1a !important; }
    </style>
</head>
<body>

<div class="quiz-container">
    <div id="start-screen">
        <h1 style="color:var(--accent-gold); font-size: 2.2rem; margin-bottom: 10px;">2000 å–®å­—æŒ‘æˆ° ğŸ”Š</h1>
        <p style="color: #888;"></p>

        
        <div class="input-group">
            <label>è«‹è¼¸å…¥æ¸¬é©—é¡Œæ•¸ï¼š</label>
            <input type="number" id="quiz-count" class="num-input" value="10" min="1" max="2000">
        </div>
        <button class="btn primary-btn" onclick="startQuiz()">é–‹å§‹æŒ‘æˆ°</button>
    </div>

    <div id="quiz-screen">
        <div class="score-board">ç›®å‰çš„å¾—åˆ†ï¼š<span id="live-score">0</span> / 100</div>
        <div id="progress" style="color:#777; font-size: 0.9rem; margin-bottom: 10px;">QUESTION 1</div>
        
        <div class="question-area">
            <div class="chinese-hint" id="chinese-text">---</div>
            <button class="audio-btn" onclick="speakCurrentWord()">ğŸ”Š</button>
        </div>

        <div class="length-info" id="length-hint">_ _ _</div>
        
        <input type="text" id="answer-input" placeholder="è«‹åœ¨æ­¤è¼¸å…¥è‹±æ–‡..." autocomplete="off" spellcheck="false">
        <div id="feedback-text" style="height:35px; margin-top:10px; font-weight:bold; font-size: 1.1rem;"></div>
        
        <button id="submit-btn" class="btn primary-btn" onclick="handleAnswer()">é€å‡ºç­”æ¡ˆ</button>
    </div>

    <div id="result-screen">
        <h2 style="letter-spacing: 5px; margin-bottom: 5px;">æœ€çµ‚çµæœ</h2>
        <div class="final-score" id="total-score">0</div>
        <div id="congrats-msg" style="font-weight: bold; margin: 15px 0; font-size: 1.2rem;"></div>
        
        <div id="mistake-area" style="display: none;">
            <p style="color: var(--accent-red); font-weight: bold; text-align: left; margin-bottom: 5px;">éœ€è¤‡ç¿’çš„å–®å­—ï¼š</p>
            <div class="mistake-container">
                <table class="mistake-table">
                    <thead><tr><th>ä¸­æ–‡ (è©æ€§)</th><th>æ­£ç¢ºç­”æ¡ˆ</th></tr></thead>
                    <tbody id="mistake-body"></tbody>
                </table>
            </div>
            <button class="btn review-btn" onclick="startReview()">åƒ…è¤‡ç¿’éŒ¯é¡Œ</button>
        </div>

        <button class="btn restart-btn" onclick="location.reload()">é‡æ–°é–‹å§‹(å…¨éƒ¨å–®å­—)</button>
    </div>
</div>

<script>
    // éŸ³æ•ˆè¼‰å…¥
    const winSound = new Audio('IKEA.mp3');
    const loseSound = new Audio('0.mp3');

    let quizWords = [];
    let wrongWords = [];
    let currentIndex = 0;
    let score = 0;
    let isProcessing = false;

    function startQuiz() {
        // æª¢æŸ¥ jh2000.js æ˜¯å¦è¼‰å…¥æˆåŠŸ
        if (typeof allVocabulary === 'undefined') {
            alert("æ‰¾ä¸åˆ°å–®å­—åº«æª”æ¡ˆ jh2000.jsï¼Œè«‹ç¢ºèªè©²æª”æ¡ˆå­˜åœ¨æ–¼åŒä¸€å€‹è³‡æ–™å¤¾ã€‚");
            return;
        }

        const countInput = document.getElementById('quiz-count');
        const count = Math.min(parseInt(countInput.value) || 10, allVocabulary.length);
        
        // éš¨æ©Ÿå¾ jh2000.js çš„ allVocabulary æŒ‘é¸
        quizWords = [...allVocabulary].sort(() => Math.random() - 0.5).slice(0, count);
        
        initQuizSession();
    }

    function initQuizSession() {
        currentIndex = 0;
        score = 0;
        wrongWords = [];
        document.getElementById("start-screen").style.display = "none";
        document.getElementById("result-screen").style.display = "none";
        document.getElementById("quiz-screen").style.display = "block";
        document.getElementById("live-score").innerText = "0";
        
        // è§£é–éŸ³æ•ˆæ¬Šé™
        [winSound, loseSound].forEach(s => {
            s.play().then(() => { s.pause(); s.currentTime = 0; }).catch(() => {});
        });

        showQuestion();
    }

    function showQuestion() {
        isProcessing = false;
        const q = quizWords[currentIndex];
        const input = document.getElementById("answer-input");
        
        document.getElementById("progress").innerText = `QUESTION ${currentIndex + 1} / ${quizWords.length}`;
        document.getElementById("chinese-text").innerText = q.pos ? `${q.zh} (${q.pos})` : q.zh;
        document.getElementById("length-hint").innerText = q.en.split('').map(c => c === " " ? "\u00A0" : "_").join(" ");
        
        document.getElementById("feedback-text").innerText = "";
        input.value = "";
        input.className = "";
        input.disabled = false;
        input.focus();
        document.getElementById("submit-btn").disabled = false;
    }

    function speakCurrentWord() {
        const q = quizWords[currentIndex];
        if (!q) return;
        window.speechSynthesis.cancel();
        const msg = new SpeechSynthesisUtterance(q.en);
        msg.lang = 'en-US';
        msg.rate = 0.8;
        window.speechSynthesis.speak(msg);
    }

    function handleAnswer() {
        if (isProcessing) return;
        const inputField = document.getElementById("answer-input");
        const feedbackField = document.getElementById("feedback-text");
        const userInput = inputField.value.trim().toLowerCase();
        const correctAnswer = quizWords[currentIndex].en.toLowerCase();

        if (userInput === "") return;
        
        isProcessing = true;
        inputField.disabled = true;
        document.getElementById("submit-btn").disabled = true;

        if (userInput === correctAnswer) {
            score += (100 / quizWords.length);
            document.getElementById("live-score").innerText = Math.round(score);
            inputField.classList.add("correct-flash");
            feedbackField.innerText = "æ­£ç¢ºï¼CORRECT!";
            feedbackField.style.color = "#27ae60";
        } else {
            wrongWords.push(quizWords[currentIndex]);
            inputField.classList.add("wrong-flash");
            feedbackField.innerText = `éŒ¯èª¤ï¼ç­”æ¡ˆæ˜¯ï¼š${correctAnswer.toUpperCase()}`;
            feedbackField.style.color = "#e74c3c";
        }

        setTimeout(() => {
            if (currentIndex < quizWords.length - 1) {
                currentIndex++;
                showQuestion();
            } else {
                showResult();
            }
        }, 1500);
    }

    function showResult() {
        document.getElementById("quiz-screen").style.display = "none";
        document.getElementById("result-screen").style.display = "block";
        
        const finalScore = Math.round(score);
        document.getElementById("total-score").innerText = finalScore;
        const msgBox = document.getElementById("congrats-msg");
        const mistakeArea = document.getElementById("mistake-area");
        const mistakeBody = document.getElementById("mistake-body");

        mistakeBody.innerHTML = "";

        if (finalScore >= 100) {
            msgBox.innerHTML = "ğŸ† å®Œç¾å…¨å°ï¼ä½ æ˜¯å–®å­—å¤§å¸«ï¼";
            msgBox.style.color = "#f1c40f";
            mistakeArea.style.display = "none";
            winSound.play().catch(() => {});
            fireConfetti();
        } else {
            mistakeArea.style.display = "block";
            wrongWords.forEach(w => {
                const qText = w.pos ? `${w.zh} (${w.pos})` : w.zh;
                const row = `<tr><td>${qText}</td><td class="correct-ans">${w.en}</td></tr>`;
                mistakeBody.insertAdjacentHTML('beforeend', row);
            });
            if (finalScore === 0) {
                msgBox.innerText = "ğŸ’€ æˆç¸¾ä¸ä½³...å†è©¦ä¸€æ¬¡å§ï¼";
                msgBox.style.color = "#ff4d4d";
                loseSound.play().catch(() => {});
            } else {
                msgBox.innerText = "æŒ‘æˆ°çµæŸï¼åŠ æ²¹ï¼";
                msgBox.style.color = "#f1c40f";
            }
        }
    }

    function startReview() {
        quizWords = [...wrongWords];
        initQuizSession();
    }

    document.getElementById("answer-input").addEventListener("keypress", (e) => {
        if (e.key === "Enter") handleAnswer();
    });

    function fireConfetti() {
        const duration = 4000;
        const end = Date.now() + duration;
        (function frame() {
            confetti({ particleCount: 5, angle: 60, spread: 55, origin: { x: 0 } });
            confetti({ particleCount: 5, angle: 120, spread: 55, origin: { x: 1 } });
            if (Date.now() < end) requestAnimationFrame(frame);
        }());
    }
</script>

</body>
</html>
